# 게임 룰 사양서

## 게임 개요
Castle Defense는 Flutter + Flame 엔진 기반의 타워 디펜스 게임입니다. 플레이어는 성을 지키며 라운드를 클리어하여 스테이지를 진행합니다.

## 게임 상태 (GameState)

### 1. 로딩 (loading)
- 게임 시작 시 0.5초 동안 로딩 게이지 표시
- 로딩 완료 후 라운드 선택 화면으로 전환

### 2. 라운드 선택 (roundSelect)
- 맵 스타일의 라운드 선택 화면
- 3x3 그리드 형식으로 라운드 1~9 표시
- 라운드 10(보스)은 중앙 하단에 큰 아이콘으로 표시
- 라운드 5(미니보스)와 라운드 10(보스)은 악마 이모지(😈) 표시
- 언락된 라운드만 선택 가능

### 3. 전투 중 (playing)
- 실제 몬스터 스폰 및 전투 진행
- 플레이어는 터치로 몬스터 공격
- 라운드 시간 제한 적용

### 4. 일시정지 (paused)
- 게임 일시정지 상태
- 우측 상단 일시정지 버튼으로 전환

### 5. 라운드 클리어 (roundClear)
- 라운드 클리어 시 2초간 대기
- 자동으로 결과 화면으로 전환

### 6. 결과 화면 (result)
- 클리어 또는 실패 결과 표시
- 획득 골드 및 경험치 표시
- 다음 라운드 언락 (클리어 시)

## 스테이지 시스템

### 스테이지 구성
- 총 8개 스테이지
- 각 스테이지당 10개 라운드
- 라운드 5: 미니보스 출현
- 라운드 10: 보스 출현

### 스테이지별 테마
1. **스테이지 1**: 초원 & 산 (🌿🏔️)
2. **스테이지 2**: 협곡 (🏜️)
3. **스테이지 3**: 사막 (🏜️)
4. **스테이지 4**: 바다 (🌊)
5. **스테이지 5**: 화산 (🌋)
6. **스테이지 6**: 얼음 성 (❄️🏰)
7. **스테이지 7**: 천국 (☁️✨)
8. **스테이지 8**: 지옥 (🔥💀)

## 몬스터 시스템

### 몬스터 타입
1. **일반 몬스터 (normal)**
   - 기본 적 유닛
   - 모든 라운드에 출현

2. **미니보스 (miniBoss)**
   - 라운드 5에 출현
   - 일반 몬스터보다 높은 HP
   - HP 공식: `10 + (stageLevel × 5)`

3. **보스 (boss)**
   - 라운드 10에 출현
   - 가장 높은 HP
   - HP 공식: `20 + (stageLevel × 10)`

### 몬스터 스폰 규칙
- 일반 몬스터는 설정된 간격마다 자동 스폰
- 보스/미니보스는 일반 몬스터가 모두 스폰된 후 1회 출현
- 낙하 → 걷기 → 성 도달 순서로 진행

### 스테이지별 몬스터 수

#### 스테이지 1
- 시작 몬스터 수: 6마리 (라운드 1)
- 라운드당 증가량: 4마리
- 예시: R1(6) → R2(10) → R3(14) → ... → R10(42)

#### 스테이지 2
- 시작 몬스터 수: 22마리
- 라운드당 증가량: 6마리
- 예시: R1(22) → R2(28) → R3(34) → ... → R10(76)

#### 스테이지 3
- 시작 몬스터 수: 40마리
- 라운드당 증가량: 8마리
- 예시: R1(40) → R2(48) → R3(56) → ... → R10(112)

#### 스테이지 4
- 시작 몬스터 수: 60마리
- 라운드당 증가량: 10마리
- 예시: R1(60) → R2(70) → R3(80) → ... → R10(150)

#### 스테이지 5
- 시작 몬스터 수: 85마리
- 라운드당 증가량: 12마리
- 예시: R1(85) → R2(97) → R3(109) → ... → R10(193)

#### 스테이지 6~8
- 시작 몬스터 수: 100마리
- 라운드당 증가량: 15마리

### 스테이지별 몬스터 HP
- 일반 몬스터 HP: `1 + stageLevel`
  - 스테이지 1: 2 HP
  - 스테이지 2: 3 HP
  - 스테이지 3: 4 HP
  - 스테이지 8: 9 HP

### 스테이지별 스폰 간격
- 스테이지 1: 1.0초
- 스테이지 2: 0.8초
- 스테이지 3: 0.7초
- 스테이지 4: 0.6초
- 스테이지 5 이상: 0.5초

## 라운드 시간 제한

### 라운드별 제한 시간
- **라운드 1~3**: 2분 (120초)
- **라운드 4~7**: 3분 (180초)
- **라운드 8~10**: 5분 (300초)

### 제한 시간 초과 시
- 라운드 실패 처리
- 결과 화면으로 전환

## 성 시스템

### 성 기본 정보
- 최대 HP: 10
- 시작 HP: 10
- 몬스터가 성에 도달 시 HP -1
- HP 0 도달 시 라운드 실패

## 승리/패배 조건

### 라운드 클리어 조건
다음 조건을 **모두** 만족해야 클리어:
1. 모든 몬스터를 처치 (보스/미니보스 포함)
2. 성 HP가 1 이상 유지
3. 제한 시간 내 완료

### 라운드 실패 조건
다음 조건 중 **하나라도** 발생하면 실패:
1. 성 HP가 0 이하로 감소
2. 제한 시간 초과

## 언락 시스템

### 라운드 언락
- 초기 상태: 라운드 1만 언락
- 라운드 클리어 시: 다음 라운드 언락
- 언락되지 않은 라운드는 선택 불가

## 갓 모드 (테스트용)

### 활성화 방법
- 게임 화면에서 특정 영역 터치로 활성화

### 갓 모드 효과
- 무한 체력 (성 HP 감소 무시)
- 테스트 및 디버깅 용도

## 게임 흐름

```
로딩 (0.5초)
    ↓
라운드 선택
    ↓
라운드 시작 (전투)
    ↓
  ┌─────┴─────┐
클리어      실패
  ↓           ↓
라운드     결과 화면
클리어
(2초)
  ↓
결과 화면
```
